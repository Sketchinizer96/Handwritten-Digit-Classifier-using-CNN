flowchart TD
    %% SECTION 1: INPUT AND CLASSIFICATION %%
    A["User Chat Input\n(Incident ID / List / Description)\nUsers report issues via chat interface\nwith varying levels of detail"] --> B["Input Classifier Agent\n(Classifies input type using LLM)\nUses semantic understanding to determine\ninput category and processing path"]

    B -->|Incident ID| C["ServiceNow Fetch Agent\n(Fetch metadata via API)\nRetrieves complete ticket details\nincluding history and attachments"]
    B -->|List of IDs| D["ServiceNow Loop Agent\n(Fetch multiple incidents)\nBatch processes related incidents\nto identify patterns and correlations"]
    B -->|Problem Description| E["Description Interpreter Agent\n(LLM extracts metadata)\nConverts natural language to\nstructured incident parameters"]

    %% SECTION 2: VALIDATION AND KNOWLEDGE INTEGRATION %%
    C --> F["Input Validator Agent\n(LLM checks completeness of metadata)\nEnsures all required fields are present\nVerifies data consistency and format"]
    D --> F
    E --> F

    F -->|Incomplete| G["Chat Feedback Agent\n(Request missing fields from user)\nGenerates natural language queries\nto obtain missing critical information"]
    G --> F
    F -->|Complete| H["Vector Memory Lookup Agent\n(Search for similar incidents)\nQueries vector database of past incidents\nUses semantic search to find relevant matches"]

    %% SECTION 3: MEMORY AND PLANNING %%
    H --> I{"Similar Case Found?"}
    I -->|Yes| J["Case Memory Agent\n(Retrieve past plan, resolution & docs)\nExtracts successful resolution workflows\nIdentifies relevant documentation\nAdapts previous approaches to current context"]
    I -->|No| K["Planning Agent\n(ReAct-based step-by-step diagnostic)\nFormulates reasoning + action plan\nBreaks down complex problems\nCreates testable hypotheses"]

    %% SECTION 4: ORCHESTRATION LAYER %%
    J --> L["Orchestration Layer\n(Coordinates agent activities & workflows)\nManages execution sequence and dependencies\nHandles parallelization of compatible tasks\nMonitors timeouts and sets priorities\nProvides unified context across agents"]
    K --> L

    %% SECTION 5: SPECIALIZED AGENTS %%
    L --> M{"Dispatch to Specialized Agents"}

    M --> M1["Monitoring Agent\n(App healthcheck, metrics)\nChecks service availability\nGathers performance metrics\nMonitors SLA compliance\nTracks system resource usage"]
    M --> M2["Log Analysis Agent\n(Parse logs, identify patterns)\nSearches for error signatures\nCorrelates events across time\nIdentifies anomalous patterns\nExtracts contextual information"]
    M --> M3["Database Agent\n(Query errors, performance)\nExecutes diagnostic queries\nAnalyzes query performance\nChecks data integrity\nMonitors connection pools"]
    M --> M4["Infrastructure Agent\n(K8s status, resources)\nInspects container health\nChecks node availability\nAnalyzes network connectivity\nMonitors cluster resources"]
    M --> M5["Security Agent\n(Auth issues, anomalies)\nVerifies authentication flows\nChecks authorization policies\nScans for security events\nIdentifies potential breaches"]

    %% SECURE AUTHENTICATION SERVICE %%
    M1 & M2 & M3 & M4 & M5 --> Auth["Secure Auth Service\n(Token management from Vault)\nCentralized credential management\nJust-in-time access provisioning\nAuditing of all credential usage\nAutomatic token rotation"]

    Auth --> N["Observation Aggregator\n(Collects all agent outputs)\nNormalizes data from different sources\nResolves conflicting information\nStructures data for analysis\nPrioritizes critical findings"]

    %% SECTION 6: ANALYSIS AND LEARNING %%
    N --> O["Root Cause Analyzer Agent\n(Fuses observations using LLM)\nCorrelates symptoms with causes\nBuilds causal chain of events\nRanks potential root causes\nCalculates confidence scores"]
    O --> P["Summary & Recommendation Agent\n(Creates actionable insights)\nGenerates executive summaries\nFormulates resolution options\nPrioritizes recommended actions\nEstimates resolution time/impact"]
    P --> Q["Continuous Learning Module\n(Updates knowledge base)\nExtracts reusable solution patterns\nRefines diagnostic approaches\nTracks resolution effectiveness\nUpdates decision boundaries"]

    %% SECTION 7: DECISION & ACTION %%
    Q --> R{"Decision Boundary Check\nEvaluates risk, complexity & confidence\nChecks authority levels\nAssesses potential impact\nConsiders historical success rates"}
    R -->|Autonomous Action| S["Auto-Remediation Agent\n(Execute pre-approved fixes)\nRuns resolution scripts\nPerforms service restarts\nUpdates configurations\nValidates successful resolution"]
    R -->|Human Approval Needed| T["Human-AI Interface\n(Present options for approval)\nVisualizes problem & solutions\nProvides risk assessments\nShows reasoning chain\nOffers explainable recommendations"]
    
    T -->|Approved| S
    T -->|Rejected| U["Alternative Solutions Agent\n(Generate new approaches)\nExplores alternative hypotheses\nConsiders edge cases\nProposes different strategies\nIncorporates human feedback"]
    U --> T

    %% SECTION 8: CLOSEOUT AND KNOWLEDGE UPDATE %%
    S --> V["Documentation Agent\n(Update ServiceNow & knowledge)\nGenerates detailed resolution notes\nLinks related tickets & knowledge\nCreates knowledge base articles\nDocuments lessons learned"]
    V --> W["Vector Memory Update\n(Store incident & resolution pattern)\nIndexes full resolution chain\nUpdates similarity models\nRefines vector embeddings\nImproves future retrieval accuracy"]
    W --> X["End"]